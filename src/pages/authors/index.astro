---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import SeoPage from "@/components/SeoPage.astro";
import { slugifyAuthor } from "@/lib/util";

const posts = await getCollection("blog");
const counts = new Map<string, number>();
for (const p of posts) {
  for (const a of p.data.authors || []) {
    counts.set(a, (counts.get(a) || 0) + 1);
  }
}
const authors = Array.from(counts.entries()).sort((a, b) => a[0].localeCompare(b[0]));
---

<BaseLayout>
  <SeoPage
    slot="head"
    title="Authors"
    description="Browse posts by author"
  />
  <section class="py-3">
    <h1 class="mb-4 text-2xl font-bold">Authors</h1>
    {
      authors.length === 0 ?
        <p class="text-neutral-600 dark:text-neutral-300">No authors found yet.</p>
      : <div class="flex flex-wrap gap-2">
          {authors.map(([name, count]) => (
            <a
              class="rounded-full border border-neutral-300 px-3 py-1 text-sm hover:bg-neutral-100 dark:border-neutral-700 dark:hover:bg-neutral-900"
              href={`/authors/${slugifyAuthor(name)}`}>
              {name} <span class="opacity-60">({count})</span>
            </a>
          ))}
        </div>
    }
  </section>
</BaseLayout>
